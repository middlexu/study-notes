# 状态模式

状态模式（State Pattern）：它主要用来解决对象在多种状态转换时，需要对外输出不同的行为的问题。状态 和行为是一一对应的，状态之间可以相互转换

当一个对象的内在状态改变时，允许改变其行为，这个对象看起来像是改变了其类



# 案例

步骤 1
创建一个接口。

```java
//State.java
public interface State {
   public void doAction(Context context);
}
```

步骤 2
创建实现接口的实体类。
```java
//StartState.java
public class StartState implements State {
 
   public void doAction(Context context) { // 接收上下文对象
      System.out.println("Player is in start state");
      System.out.println("播放完毕");
      context.setState(context.stopState); // 执行行为后，改变上下文state
   }
 
   public String toString(){
      return "Start State";
   }
}
```
```java
//StopState.java
public class StopState implements State {
 
   public void doAction(Context context) {
      System.out.println("Player is in stop state");
      System.out.println("不能进行任何操作了");
   }
 
   public String toString(){
      return "Stop State";
   }
}
```

步骤 3
创建 Context 类。
```java
//Context.java
public class Context {
   private State state; //聚合了State
   
   // 两个属性，表示两种状态
   private State startState = new StartState()
   private State stopState = new StopState()
 
   public Context(){
      this.state = startState;
   }
 
   public void doAction(){
      this.state.doAction(this);   
   }
    
   public void setState(State state){
      this.state = state;     
   }
 
   public State getState(){
      return state;
   }
}
```

步骤 4
使用 Context 来查看当状态 State 改变时的行为变化。
```java
//StatePatternDemo.java
public class StatePatternDemo {
   public static void main(String[] args) {
      Context context = new Context();
 
      System.out.println(context.getState().toString());
      context.doAction();
      
      System.out.println(context.getState().toString());
      context.doAction();
 
      
   }
}
```

步骤 5
执行程序，输出结果：

```
Start State
Player is in start state
播放完毕
Stop State
Player is in stop state
不能进行任何操作了
```





## 注意事项和细节 

1) 代码有很强的可读性。状态模式将每个状态的行为封装到对应的一个类中 

2) 方便维护。将容易产生问题的 if-else 语句删除了，如果把每个状态的行为都放到一个类中，每次调用方法时都 要判断当前是什么状态，不但会产出很多 if-else 语句，而且容易出错

3) 符合“开闭原则”。容易增删状态 

4) 会产生很多类。每个状态都要一个对应的类，当状态过多时会产生很多类，加大维护难度 

5) 应用场景：当一个事件或者对象有很多种状态，状态之间会相互转换，对不同的状态要求有不同的行为的时候， 可以考虑使用状态模式

